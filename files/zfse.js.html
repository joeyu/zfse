<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>zfse.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title=""></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/zfse.html">zfse</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/zfse.html">zfse</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: zfse.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /* Copyright 2014 Zhou Yu
                         */
                        /**
                         * Zhou&#x27;s File System Extension to the &#x27;fs&#x27; module of node.js.
                         *
                         * @module zfse
                         * @class zfse
                         * @static
                         */
                        var fs = require(&#x27;fs&#x27;);
                        var path = require(&#x27;path&#x27;);
                        
                        module.exports = {
                            &#x27;traverse&#x27;:     traverse,     // Traverses a directory
                            &#x27;rRmDirSync&#x27;:   rRmDirSync,   // Recursively removes a directory
                            &#x27;rRenameSync&#x27;:  rRenameSync,  // Recursively Rename all files under a directory
                            &#x27;find&#x27;:         find,         // Find files according to a specified file name pattern
                        };
                        
                        /**
                         * Traverses through the specified &#x27;dir&#x27; directory tree, and apply the 
                         * specificed &#x27;callback&#x27; function to each file node with optional 
                         * &#x27;callback_arg&#x27; arguments passed to the function.
                         *
                         * @method traverse
                         * @param dir {String} The directory to traverse.
                         * @param [callback] {Function} The callback function to call for each file node traversing through.
                         * @param [...callback_arg] The parameters to be passed to the &#x27;callback&#x27;.
                         */
                        function traverse(fpath, callback) {
                            var cbArgs = Array.prototype.slice.call(arguments, 2); // gets callback arguments
                            var stat = fs.lstatSync(fpath);
                            if (stat.isDirectory()) {
                                var files = fs.readdirSync(fpath);
                                files.forEach(function (f) {
                                    traverse.apply(undefined, [path.join(fpath, f), callback].concat(cbArgs));
                                });
                            }
                            callback.apply(undefined, [fpath].concat(cbArgs));
                        }
                        
                        /**
                         * Recursively removes a directory. This function works in a similar way as linux 
                         * shell command &#x27;rm -rf&#x27;. 
                         * If &#x27;dir&#x27; is single file, this function works in the same way as fs.unlinkSync()
                         *
                         * @method rRmDirSync
                         * @param dir {String} The directory to remove.
                         * @param [options] {Object} Options when running this function.
                         * @param [options.isDryRun=false] {Boolean} Dry-runs the function w/o actually renaming.
                         * @param [options.isVerbose=false] {Boolean} Verbose log messages.
                         */
                        function rRmDirSync(dir, options) {
                            var isDryRun = false;
                            var isVerbose = false;
                        
                            for (var key in options) {
                                if (key === &#x27;isDryRun&#x27;) isDryRun = options.isDryRun;
                                if (key === &#x27;isVerbose&#x27;) isVerbose = options.isVerbose;
                            }
                        
                            traverse(dir, function (fpath) {
                                if (isVerbose) {
                                    console.log(fpath);
                                }
                                var stat = fs.lstatSync(fpath);
                                if (stat.isDirectory()) {
                                    if (!isDryRun) {
                                        fs.rmdirSync(fpath);
                                    }
                                }
                                else {
                                    if (!isDryRun) {
                                        fs.unlinkSync(fpath);
                                    }
                                }
                            });
                        }
                        
                        /**
                         * Recursively renames files matching the &#x27;oldNamePattern&#x27; regex to &#x27;newName&#x27;.
                         * This function works a a similar way as linux shell command &#x27;find -name oldNamePattern -exec mv \{\} newName \;&#x27;.
                         * 
                         * @method rRenameSync
                         * @param dir {String} The directory from which search starts.
                         * @param oldNamePattern {RegExp} Search pattern in regular expression.
                         * @param newName {String} The new name.
                         * @param [options] {Object} Options when running this function.
                         * @param [options.isDryRun=false] {Boolean} Dry-runs the function w/o actually renaming.
                         * @param [options.isVerbose=false] {Boolean} Verbose log messages
                         */
                        function rRenameSync(dir, oldNamePattern, newName, options) {
                            var isDryRun = false;
                            var isVerbose = false;
                        
                            for (var key in options) {
                                if (key === &#x27;isDryRun&#x27;) isDryRun = options.isDryRun;
                                if (key === &#x27;isVerbose&#x27;) isVerbose = options.isVerbose;
                            }
                        
                            traverse(dir, function (fpath) {
                                var basename = path.basename(fpath);
                                var dirname = path.dirname(fpath);
                                var basename2 = basename.replace(oldNamePattern, newName);
                                if (basename2 !== basename) {
                                    var fpath2  = path.join(dirname, basename2);
                                    if (isVerbose) {
                                        console.log(&quot;%s --&gt; %s&quot;, fpath1, fpath2);
                                    }
                                    if (!isDryrun) {
                                        fs.renameSync(fpath, fpath2);
                                    }
                                }
                            });
                        }
                        
                        /**
                         * Searches the specified directory &#x27;dir&#x27; for an optionally specified &#x27;namePattern&#x27; 
                         * file name pattern, calling the &#x27;callback&#x27; function with &#x27;callback_arg&#x27; arguments
                         * if specified.
                         *
                         * @method find
                         * @param dir {String} The directory from which search starts.
                         * @param namePatten {RegExp} Search pattern in regular expression.
                         * @param [callback] {Function} The callback funtion to run for each file node that is found
                         * @param [...callback_arg] The parameters to be passed to the &#x27;callback&#x27;.
                         */
                        function find(dir, namePattern, callback) {
                            // arguments
                            var cbArgs = Array.prototype.slice.call(arguments, 3); // gets callback arguments
                            if (typeof namePattern === &#x27;function&#x27;) {
                                callback = namePattern; // no namePattern, but callback only
                                namePattern = null;
                                cbArgs = Array.prototype.slice.call(arguments, 2); // gets callback arguments
                            }
                            traverse (dir, function (fpath) {
                                if (namePattern) {
                                    var basename = path.basename(fpath);
                                    if (namePattern.exec(basename)) {
                                        console.log(fpath);
                                    }
                                }
                                else { //matched anything
                                    console.log(fpath);
                                }
                        
                                if (callback) {
                                    callback.apply(undefined, [fpath].concat(cbArgs));
                                }
                            });
                        }
                        
                        
                        
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
